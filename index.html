<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œë˜ ë²ˆí˜¸ ìƒì„±ê¸° v7.0 (ìµœì¢… ìˆ˜ì •)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* CSSëŠ” ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤ */
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --secondary-hover: #5a6268;
            --bg-color: #f8f9fa;
            --content-bg: #ffffff;
            --border-color: #dee2e6;
            --text-color: #212529;
            --text-light: #495057;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); display: grid; place-items: center; min-height: 100vh; margin: 0; padding: 1rem; box-sizing: border-box; }
        .container { width: 100%; max-width: 700px; background: var(--content-bg); padding: 2rem 2.5rem; border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08); text-align: center; }
        h1 { color: var(--primary-color); margin-top: 0; margin-bottom: 0.5rem; font-weight: 700; }
        .subtitle { font-size: 1.1rem; color: var(--text-light); margin-bottom: 2rem; }
        .controls { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem; }
        .control-group { display: flex; gap: 1rem; }
        label { font-weight: 600; display: block; margin-bottom: 0.5rem; text-align: left; color: var(--text-color); }
        select, button { padding: 0.8rem 1rem; font-size: 1rem; border-radius: 8px; font-family: inherit; border: 1px solid var(--border-color); height: 50px; box-sizing: border-box; }
        select { flex-grow: 1; }
        button { cursor: pointer; border: none; font-weight: 600; transition: all 0.2s ease-in-out; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        #generate-btn { background-color: var(--primary-color); color: white; flex-basis: 150px; }
        #generate-btn:hover { background-color: var(--primary-hover); }
        button:disabled { opacity: 0.5; cursor: not-allowed; background-color: #eee; color: #aaa; border-color: #ddd; }
        #pdf-btn { background-color: var(--content-bg); color: var(--secondary-color); border: 1px solid var(--secondary-color); flex-basis: 150px; }
        #pdf-btn:hover { background-color: var(--secondary-color); color: white; }
        #pdf-btn:disabled { background-color: #eee; border-color: #ddd; }
        #loading-msg { font-weight: 600; color: var(--secondary-color); transition: color 0.3s; }
        #results-container { display: none; text-align: left; margin-top: 2rem; }
        #results-container h3 { margin-bottom: 1rem; border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; }
        #results-display { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; max-height: 400px; overflow-y: auto; padding-top: 0.5rem; }
        .lotto-box { background: #fdfdfd; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04); }
        .lotto-box p { font-family: monospace; font-size: 1.1rem; color: var(--text-light); margin: 0.8rem 0; display: flex; }
        .lotto-box p span { width: 30px; color: var(--text-color); font-weight: 600; }
        @media (max-width: 500px) { .control-group { flex-direction: column; } .container { padding: 1.5rem; } }
    </style>
</head>
<body>
    
    <div class="container">
        <h1>ğŸ€ ë¡œë˜ ë²ˆí˜¸ ìƒì„±ê¸°</h1>
        <p class="subtitle">ì›í•˜ëŠ” ì¡°í•© ê°œìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        
        <div class="controls">
            <label for="count-select">ìƒì„±í•  ì¡°í•© ìˆ˜:</label>
            <div class="control-group">
                <select name="count" id="count-select">
                    <option value="5">5ê°œ</option>
                    <option value="10">10ê°œ</option>
                    <option value="20">20ê°œ</option>
                    <option value="30">30ê°œ</option>
                    <option value="40">40ê°œ</option>
                    <option value="50">50ê°œ</option>
                </select>
                <button type="button" id="generate-btn" disabled>ë²ˆí˜¸ ìƒì„±</button>
            </div>
            <button type="button" id="pdf-btn" disabled>ğŸ“„ PDFë¡œ ë‹¤ìš´ë¡œë“œ</button>
        </div>
        
        <p id="loading-msg">â³ í°íŠ¸ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>

        <div id="results-container">
            <h3>ìƒì„±ëœ ë²ˆí˜¸</h3>
            <div id="results-display"></div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        let currentLottoSets = [];
        
        // [ìˆ˜ì •ë¨] í°íŠ¸ Base64ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
        let nanumFontBase64 = null; 

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: ArrayBufferë¥¼ Base64ë¡œ ---
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }

        /**
         * [ìˆ˜ì •ë¨] í°íŠ¸ ë¡œë”© ë° ë²„íŠ¼ í™œì„±í™” í•¨ìˆ˜
         */
        async function loadFontAndSetup() {
            const generateBtn = document.getElementById('generate-btn');
            const loadingMsg = document.getElementById('loading-msg');
            const pdfBtn = document.getElementById('pdf-btn');
            const countSelect = document.getElementById('count-select');
            const resultsContainer = document.getElementById('results-container');
            
            try {
                // 1. .ttf í°íŠ¸ íŒŒì¼ì„ fetchë¡œ ë‹¤ìš´ë¡œë“œ
                const fontUrl = 'https://cdn.jsdelivr.net/font-nanum/1.0/nanumgothic/v3/NanumGothic-Regular.ttf';
                const response = await fetch(fontUrl);
                
                if (!response.ok) {
                    throw new Error('í°íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
                }
                
                const fontBuffer = await response.arrayBuffer();
                
                // 2. [ìˆ˜ì •ë¨] í°íŠ¸ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                nanumFontBase64 = arrayBufferToBase64(fontBuffer);
                
                // 3. í°íŠ¸ ë¡œë”© ì„±ê³µ! ë²„íŠ¼ í™œì„±í™”
                loadingMsg.textContent = "âœ… í°íŠ¸ ë¡œë”© ì™„ë£Œ!";
                loadingMsg.style.color = "green";
                generateBtn.disabled = false; // 'ë²ˆí˜¸ ìƒì„±' ë²„íŠ¼ í™œì„±í™”
                
                // 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                generateBtn.addEventListener('click', () => {
                    const count = parseInt(countSelect.value, 10);
                    currentLottoSets = generateLottoSets(count);
                    displayResults(currentLottoSets);
                    resultsContainer.style.display = 'block';
                    pdfBtn.disabled = false;
                });

                pdfBtn.addEventListener('click', () => {
                    if (currentLottoSets.length > 0) {
                        createLottoPDF(currentLottoSets); // í°íŠ¸ê°€ ë“±ë¡ëœ doc ê°ì²´ë¥¼ ì „ë‹¬í•  í•„ìš” ì—†ìŒ
                    } else {
                        alert("ë¨¼ì € ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.");
                    }
                });
                
                setTimeout(() => { loadingMsg.style.display = 'none'; }, 2000);

            } catch (error) {
                console.error("í°íŠ¸ ë¡œë”© ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ:", error);
                loadingMsg.textContent = "âŒ í°íŠ¸ ë¡œë”© ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.";
                loadingMsg.style.color = "red";
            }
        }

        function generateLottoSets(count) {
            const sets = [];
            for (let i = 0; i < count; i++) {
                const numbers = new Set();
                while (numbers.size < 6) {
                    const randomNum = Math.floor(Math.random() * 45) + 1;
                    numbers.add(randomNum);
                }
                const sortedNumbers = Array.from(numbers).sort((a, b) => a - b);
                sets.push(sortedNumbers);
            }
            return sets;
        }

        function displayResults(lottoSets) {
            const displayElement = document.getElementById('results-display');
            displayElement.innerHTML = '';
            for (let i = 0; i < lottoSets.length; i += 5) {
                const chunk = lottoSets.slice(i, i + 5);
                const box = document.createElement('div');
                box.className = 'lotto-box';
                let boxHTML = ''; 
                chunk.forEach((numberSet, index) => {
                    const formattedNumbers = numberSet.map(num => num.toString().padStart(2, '0')).join("  "); 
                    const overallIndex = (i + index + 1).toString().padStart(2, '0');
                    boxHTML += `<p><span>${overallIndex}.</span> ${formattedNumbers}</p>`;
                });
                box.innerHTML = boxHTML;
                displayElement.appendChild(box);
            }
        }

        /**
         * [ìˆ˜ì •ë¨] PDF ìƒì„± ì‹œì ì— í°íŠ¸ë¥¼ ë“±ë¡í•˜ëŠ” í•¨ìˆ˜
         */
        function createLottoPDF(lottoSets) {
            // 1. ìƒˆ PDF ë¬¸ì„œë¥¼ ìƒì„±
            const doc = new jsPDF({ unit: 'mm', format: 'a4' });
            
            // 2. í°íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ ìµœì¢… í™•ì¸
            if (!nanumFontBase64) {
                alert("ì˜¤ë¥˜: í°íŠ¸ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.");
                return;
            }

            try {
                // 3. [í•µì‹¬] ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ëœ í°íŠ¸ ë°ì´í„°ë¥¼ ì´ PDF ê°ì²´ì— ë“±ë¡
                doc.addFileToVFS('NanumGothic.ttf', nanumFontBase64);
                doc.addFont('NanumGothic.ttf', 'NanumGothic', 'normal');
                doc.setFont('NanumGothic', 'normal');
            } catch (e) {
                console.error("PDF í°íŠ¸ ì„¤ì • ì˜¤ë¥˜:", e);
                alert("ì¹˜ëª…ì ì¸ ì˜¤ë¥˜: í°íŠ¸ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                return;
            }
            
            // --- 4. ë‚˜ë¨¸ì§€ PDF ìƒì„± ì½”ë“œëŠ” ë™ì¼ ---
            const margin = 20;
            const pageHeight = doc.internal.pageSize.getHeight();
            const pageWidth = doc.internal.pageSize.getWidth();
            const usableWidth = pageWidth - (margin * 2);
            const boxGapX = 10;
            const boxGapY = 8;
            const boxWidth = (usableWidth - boxGapX) / 2;
            const lineHeight = 7;
            const boxPadding = 8;
            const boxHeight = (lineHeight * 5) + (boxPadding * 2);
            const col1X = margin;
            const col2X = margin + boxWidth + boxGapX;
            let currentY = margin + 10;
            doc.setFontSize(18);
            doc.text("ğŸ€ ë¡œë˜ ë²ˆí˜¸ ìƒì„± ê²°ê³¼", pageWidth / 2, currentY, { align: 'center' });
            currentY += 15;
            doc.setFontSize(11);
            let colIndex = 0; 
            for (let i = 0; i < lottoSets.length; i += 5) {
                const chunk = lottoSets.slice(i, i + 5);
                const currentX = (colIndex === 0) ? col1X : col2X;
                if (currentY + boxHeight > pageHeight - margin) {
                    doc.addPage();
                    currentY = margin; 
                    doc.setFont('NanumGothic', 'normal'); // ìƒˆ í˜ì´ì§€ì—ë„ í°íŠ¸ ì„¤ì •
                    doc.setFontSize(11);
                }
                doc.setDrawColor('#dee2e6'); 
                doc.roundedRect(currentX, currentY, boxWidth, boxHeight, 3, 3, 'S'); 
                let textY = currentY + boxPadding + (lineHeight / 2); 
                chunk.forEach((numberSet, index) => {
                    const formattedNumbers = numberSet.map(num => num.toString().padStart(2, '0')).join("  ");
                    const overallIndex = (i + index + 1).toString().padStart(2, '0');
                    const lineText = `${overallIndex}.   ${formattedNumbers}`;
                    doc.text(lineText, currentX + padding, textY);
                });
                if (colIndex === 0) { colIndex = 1; } 
                else { colIndex = 0; currentY += boxHeight + boxGapY; }
            }
            doc.save('lotto_numbers.pdf');
        }

        // DOM ë¡œë“œê°€ ì™„ë£Œë˜ë©´ í°íŠ¸ ë¡œë”© ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            if (window.jspdf && window.jspdf.jsPDF) {
                loadFontAndSetup();
            } else {
                const loadingMsg = document.getElementById('loading-msg');
                loadingMsg.textContent = "âŒ jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨.";
                loadingMsg.style.color = "red";
            }
        });

    </script>
</body>
</html>
